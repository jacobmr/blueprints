alias: Dimming Loop
fields:
  target:
    name: Target Light
    selector:
      target:
        entity:
          domain: light
  direction:
    name: Direction
    selector:
      select:
        options:
          - up
          - down
  step:
    name: Step Percentage
    default: 10
    selector:
      number:
        min: 1
        max: 100
        mode: box
  delay:
    name: Delay between steps (seconds)
    default: 0.2
    selector:
      number:
        min: 0.01
        max: 1
        step: 0.01
        mode: box
mode: restart
sequence:
  - repeat:
      while:
        - condition: template
          value_template: >
            {{ is_state('script.dimming_loop', 'on') }}
      sequence:
        - service: light.turn_on
          target: "{{ target }}"
          data:
            brightness_step_pct: >
              {% if direction == 'up' %}{{ step }}{% else %}{{ -step }}{% endif %}
        - delay: '{{ "%0.2f"|format(delay|float) }}'
